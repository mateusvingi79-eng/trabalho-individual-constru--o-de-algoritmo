---
title: "Regressão linear"
author: "Mateus correa vingi"
date: "2025-11-23"
categories: ["programacao", "atividade"]
format:
  html:
    toc: true
    code-copy: true
    code-overflow: wrap
execute:
  echo: true
  warning: false
  message: false
  error: true
code-tools: true
lang: pt-BR
---

# {{< meta title >}}

**Autor:** {{< meta author >}}  
**Data:** {{< meta date >}}

---

## Descrição da Atividade

Descreva aqui o objetivo da atividade, o contexto (por exemplo, "Trabalho avaliativo da disciplina de Programação"), e o que será implementado.

## Código da Solução

Explique brevemente o que o código faz antes de mostrá-lo.

```python
import numpy as np
import pandas as pd
import plotly.graph_objects as go
import plotly.express as px

def ler_dados(arquivo_x='X.txt', arquivo_y='y.txt'):
    """
    Lê os dados dos arquivos X.txt e y.txt
    
    Parâmetros:
    arquivo_x (str): Nome do arquivo com valores de X (anos de estudo)
    arquivo_y (str): Nome do arquivo com valores de y (salário)
    
    Retorna:
    tuple: (array X, array y)
    """
    try:
        # Ler arquivo X
        with open(arquivo_x, 'r') as f:
            X = np.array([float(linha.strip()) for linha in f.readlines()])
        
        # Ler arquivo y
        with open(arquivo_y, 'r') as f:
            y = np.array([float(linha.strip()) for linha in f.readlines()])
        
        print(f"✓ Dados carregados com sucesso!")
        print(f"  - Total de observações: {len(X)}")
        print(f"  - Anos de estudo (X): {X[:5]}... (primeiros 5 valores)")
        print(f"  - Salários (y): {y[:5]}... (primeiros 5 valores)")
        
        return X, y
    
    except FileNotFoundError as e:
        print(f"✗ Erro: Arquivo não encontrado - {e}")
        return None, None
    except Exception as e:
        print(f"✗ Erro ao ler dados: {e}")
        return None, None


def calcular_regressao_linear(X, y):
    """
    Calcula os coeficientes da regressão linear usando a fórmula matricial.
    
    Fórmula: β = (X^T * X)^(-1) * X^T * y
    Onde β = [a, b] sendo a = intercepto e b = coeficiente angular
    
    Parâmetros:
    X (array): Valores da variável independente (anos de estudo)
    y (array): Valores da variável dependente (salário)
    
    Retorna:
    tuple: (a, b) - intercepto e coeficiente angular
    """
    
    # Adicionar coluna de 1's para o intercepto
    n = len(X)
    X_matrix = np.column_stack([np.ones(n), X])
    
    # Fórmula matricial: β = (X^T * X)^(-1) * X^T * y
    X_transposta = X_matrix.T
    produto = X_transposta @ X_matrix  # X^T * X
    inversa = np.linalg.inv(produto)   # (X^T * X)^(-1)
    beta = inversa @ X_transposta @ y  # β = (X^T * X)^(-1) * X^T * y
    
    a = beta[0]  # Intercepto
    b = beta[1]  # Coeficiente angular (slope)
    
    print(f"\n{'='*60}")
    print(f"COEFICIENTES DA REGRESSÃO LINEAR")
    print(f"{'='*60}")
    print(f"Intercepto (a): {a:.4f}")
    print(f"Coeficiente Angular (b): {b:.4f}")
    print(f"\nEquação da reta: y = {a:.4f} + {b:.4f} * x")
    print(f"{'='*60}\n")
    
    # Calcular métricas
    y_pred = a + b * X
    residuos = y - y_pred
    r_squared = 1 - (np.sum(residuos**2) / np.sum((y - np.mean(y))**2))
    
    print(f"Métricas do Modelo:")
    print(f"  - R² (coeficiente de determinação): {r_squared:.4f}")
    print(f"  - Correlação: {np.sqrt(r_squared):.4f}")
    
    return a, b


def criar_grafico_plotly(X, y, a, b):
    """
    Cria gráfico de dispersão com a linha de regressão usando Plotly.
    
    Parâmetros:
    X (array): Valores de X (anos de estudo)
    y (array): Valores de y (salário)
    a (float): Intercepto
    b (float): Coeficiente angular
    
    Retorna:
    plotly.graph_objects.Figure: Gráfico interativo
    """
    
    # Valores preditos pela regressão
    y_pred = a + b * X
    
    # Criar figura
    fig = go.Figure()
    
    # Adicionar pontos observados
    fig.add_trace(go.Scatter(
        x=X,
        y=y,
        mode='markers',
        name='Dados Observados',
        marker=dict(
            size=8,
            color='blue',
            opacity=0.6
        ),
        hovertemplate='Anos de Estudo: %{x}<br>Salário: R$ %{y:.2f}<extra></extra>'
    ))
    
    # Adicionar linha de regressão
    fig.add_trace(go.Scatter(
        x=X,
        y=y_pred,
        mode='lines',
        name=f'Regressão Linear<br>y = {a:.2f} + {b:.2f}x',
        line=dict(
            color='red',
            width=3
        ),
        hovertemplate='Anos de Estudo: %{x}<br>Salário Previsto: R$ %{y:.2f}<extra></extra>'
    ))
    
    # Configurar layout
    fig.update_layout(
        title={
            'text': 'Regressão Linear: Anos de Estudo vs Salário',
            'x': 0.5,
            'xanchor': 'center',
            'font': {'size': 20, 'color': '#2c3e50'}
        },
        xaxis_title='Anos de Estudo',
        yaxis_title='Salário (R$)',
        hovermode='closest',
        template='plotly_white',
        legend=dict(
            yanchor="top",
            y=0.99,
            xanchor="left",
            x=0.01,
            bgcolor='rgba(255, 255, 255, 0.8)',
            bordercolor='gray',
            borderwidth=1
        ),
        font=dict(size=12),
        plot_bgcolor='#f8f9fa'
    )
    
    # Adicionar grid
    fig.update_xaxes(showgrid=True, gridwidth=1, gridcolor='lightgray')
    fig.update_yaxes(showgrid=True, gridwidth=1, gridcolor='lightgray')
    
    return fig


def criar_grafico_plotnine(X, y, a, b):
    """
    Cria gráfico usando plotnine (gramática de gráficos similar ao ggplot2 do R).
    
    Parâmetros:
    X (array): Valores de X (anos de estudo)
    y (array): Valores de y (salário)
    a (float): Intercepto
    b (float): Coeficiente angular
    """
    try:
        from plotnine import (
            ggplot, aes, geom_point, geom_abline, 
            labs, theme_minimal, ggsave
        )
        
        # Criar DataFrame
        df = pd.DataFrame({"x": X, "y": y})
        
        # Criar gráfico
        plot = (
            ggplot(df, aes("x", "y"))
            + geom_point(color='blue', alpha=0.6, size=3)
            + geom_abline(intercept=a, slope=b, color='red', size=1.5)
            + labs(
                title='Regressão Linear: Anos de Estudo vs Salário',
                x='Anos de Estudo',
                y='Salário (R$)'
            )
            + theme_minimal()
        )
        
        # Salvar gráfico
        ggsave(plot, "grafico_regressao.png", dpi=300, width=10, height=6)
        print("✓ Gráfico plotnine salvo como 'grafico_regressao.png'")
        
        return plot
        
    except ImportError:
        print("⚠ plotnine não está instalado. Use: pip install plotnine")
        print("  Continuando apenas com Plotly...")
        return None


# EXECUÇÃO PRINCIPAL
if __name__ == "__main__":
    
    print("="*60)
    print("ANÁLISE DE REGRESSÃO LINEAR")
    print("Anos de Estudo vs Salário")
    print("="*60 + "\n")
    
    # PASSO 1: Ler os dados dos arquivos
    X, y = ler_dados('X.txt', 'y.txt')
    
    if X is not None and y is not None:
        
        # PASSO 2: Calcular regressão linear usando fórmula matricial
        a, b = calcular_regressao_linear(X, y)
        
        # PASSO 3: Criar gráfico com Plotly (interativo)
        print("\nGerando gráfico interativo com Plotly...")
        fig_plotly = criar_grafico_plotly(X, y, a, b)
        
        # Salvar gráfico HTML
        fig_plotly.write_html("grafico_regressao_plotly.html")
        print("✓ Gráfico Plotly salvo como 'grafico_regressao_plotly.html'")
        
        # Mostrar gráfico
        fig_plotly.show()
        
        # PASSO 4: Criar gráfico com plotnine (opcional)
        print("\nGerando gráfico com plotnine (estilo ggplot)...")
        plot_plotnine = criar_grafico_plotnine(X, y, a, b)
        
        # Interpretação dos resultados
        print(f"\n{'='*60}")
        print("INTERPRETAÇÃO DOS RESULTADOS")
        print(f"{'='*60}")
        print(f"Para cada ano adicional de estudo,")
        print(f"o salário aumenta em média R$ {b:.2f}")
        print(f"\nUma pessoa sem nenhum ano de estudo (X=0)")
        print(f"teria um salário base de R$ {a:.2f}")
        print(f"{'='*60}\n")
    
    else:
        print("\n✗ Não foi possível carregar os dados.")
        print("\nCertifique-se de que os arquivos X.txt e y.txt estão no mesmo diretório.")
        print("\nExemplo de formato dos arquivos:")
        print("\nX.txt:")
        print("10")
        print("12")
        print("14")
        print("...")
        print("\ny.txt:")
        print("2500.50")
        print("3200.80")
        print("4100.20")
        print("...")
```


## Comentários do Autor

Use esta seção para registrar comentários pessoais sobre o que foi feito.

- atividade de regreção linear com grafico
Este espaço é reservado **apenas para o autor**, não será aberto a comentários públicos.
